<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>Provisioning your cluster using F# interactive
</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="description" content="An open source framework for large-scale distributed computation and data processing written in F#."/>
    <meta name="author" content="Jan Dzik, Nick Palladinos, Kostas Rontogiannis, Eirik Tsarpalis"/>
    
    <script src="https://code.jquery.com/jquery-1.8.0.js"></script>
    <script src="https://code.jquery.com/ui/1.8.23/jquery-ui.js"></script>
    <script src="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/js/bootstrap.min.js"></script>
    <link href="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet"/>

    <link rel="icon" type="image/png" href="http://www.mbrace.io/img/favicon-196x196.png" sizes="196x196"/>
    <link rel="icon" type="image/png" href="http://www.mbrace.io/img/favicon-160x160.png" sizes="160x160"/>
    <link rel="icon" type="image/png" href="http://www.mbrace.io/img/favicon-96x96.png" sizes="96x96"/>
    <link rel="icon" type="image/png" href="http://www.mbrace.io/img/favicon-16x16.png" sizes="16x16"/>
    <link rel="icon" type="image/png" href="http://www.mbrace.io/img/favicon-32x32.png" sizes="32x32"/>

    <link type="text/css" rel="stylesheet" href="http://www.mbrace.io/content/style.css" />
    <script type="text/javascript" src="http://www.mbrace.io/content/tips.js"></script>
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="https://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="container">
      <div class="masthead">
        <ul class="nav nav-pills pull-right">
          <li><a href="http://github.com/mbraceproject/MBrace.Core">github page</a></li>
        </ul>
        <h3 class="muted"><a href="http://www.mbrace.io/index.html">MBrace.Core and MBrace.Azure</a></h3>
      </div>
      <hr />
      <div class="row">
        <div class="span9" id="main">
          
<h1><a name="Provisioning-your-cluster-using-F-interactive" class="anchor" href="#Provisioning-your-cluster-using-F-interactive">Provisioning your cluster using F# interactive</a></h1>

<blockquote>
  <p>If using a locally simulated cluster (via ThespianCluster.fsx) you can ignore this tutorial.
This tutorial is from the <a href="https://github.com/mbraceproject/MBrace.StarterKit">MBrace Starter Kit</a>.</p>
</blockquote>

<p>In this tutorial you learn how you can use the <a href="https://www.nuget.org/packages/MBrace.Azure">MBrace.Azure.Management</a> library
to provision an MBrace cluster using F# Interactive. In order to proceed, you will need
to <a href="https://azure.microsoft.com/en-us/pricing/free-trial/">sign up</a> for an Azure subscription. Once signed up, 
<a href="https://manage.windowsazure.com/publishsettings">download your publication settings file </a>.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">// replace with your local .publishsettings path</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs4', 6)" onmouseover="showTip(event, 'fs4', 6)" class="i">pubSettingsFile</span> <span class="o">=</span> <span class="s">@&quot;C:\path\to\my.publishsettings&quot;</span> 
</code></pre></td>
</tr>
</table>

<p>Next, specify your region and the size and number of your virtual machines, and create your cluster:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs5', 7)" onmouseover="showTip(event, 'fs5', 7)" class="i">region</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs6', 8)" onmouseover="showTip(event, 'fs6', 8)" class="t">Region</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs7', 9)" onmouseover="showTip(event, 'fs7', 9)" class="i">North_Europe</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs8', 10)" onmouseover="showTip(event, 'fs8', 10)" class="i">vmSize</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs9', 11)" onmouseover="showTip(event, 'fs9', 11)" class="t">VMSize</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs10', 12)" onmouseover="showTip(event, 'fs10', 12)" class="i">Large</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs11', 13)" onmouseover="showTip(event, 'fs11', 13)" class="i">vmCount</span> <span class="o">=</span> <span class="n">4</span>
    
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs12', 14)" onmouseover="showTip(event, 'fs12', 14)" class="i">deployment</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs13', 15)" onmouseover="showTip(event, 'fs13', 15)" class="t">SubscriptionManager</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs14', 16)" onmouseover="showTip(event, 'fs14', 16)" class="f">Provision</span>(<span onmouseout="hideTip(event, 'fs4', 17)" onmouseover="showTip(event, 'fs4', 17)" class="i">pubSettingsFile</span>, <span onmouseout="hideTip(event, 'fs5', 18)" onmouseover="showTip(event, 'fs5', 18)" class="i">region</span>, <span onmouseout="hideTip(event, 'fs8', 19)" onmouseover="showTip(event, 'fs8', 19)" class="i">vmSize</span><span class="o">=</span><span onmouseout="hideTip(event, 'fs8', 20)" onmouseover="showTip(event, 'fs8', 20)" class="i">vmSize</span>, <span onmouseout="hideTip(event, 'fs11', 21)" onmouseover="showTip(event, 'fs11', 21)" class="i">vmCount</span><span class="o">=</span><span onmouseout="hideTip(event, 'fs11', 22)" onmouseover="showTip(event, 'fs11', 22)" class="i">vmCount</span>) 
</code></pre></td>
</tr>
</table>

<p>This will provision a 4-worker MBrace cluster of Large (A3) instances
Provisioning can take some time (approximately 5 minutes). 
You can now connect to your cluster as follows:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs15', 23)" onmouseover="showTip(event, 'fs15', 23)" class="i">cluster</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs16', 24)" onmouseover="showTip(event, 'fs16', 24)" class="t">AzureCluster</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs17', 25)" onmouseover="showTip(event, 'fs17', 25)" class="f">Connect</span>(<span onmouseout="hideTip(event, 'fs12', 26)" onmouseover="showTip(event, 'fs12', 26)" class="i">deployment</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs18', 27)" onmouseover="showTip(event, 'fs18', 27)" class="i">Configuration</span>, <span class="i">logger</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs19', 28)" onmouseover="showTip(event, 'fs19', 28)" class="t">ConsoleLogger</span>(<span class="k">true</span>), <span class="i">logLevel</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs20', 29)" onmouseover="showTip(event, 'fs20', 29)" class="t">LogLevel</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs21', 30)" onmouseover="showTip(event, 'fs21', 30)" class="i">Info</span>)
</code></pre></td>
</tr>
</table>

<p>You now have a connection to your cluster.</p>

<p>However you should now also record your cluster details in <code>AzureCluster.fsx</code> by evaluating the following code snippet:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span onmouseout="hideTip(event, 'fs22', 31)" onmouseover="showTip(event, 'fs22', 31)" class="t">Config</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs23', 32)" onmouseover="showTip(event, 'fs23', 32)" class="f">RecordClusterDetails</span> (<span onmouseout="hideTip(event, 'fs4', 33)" onmouseover="showTip(event, 'fs4', 33)" class="i">pubSettingsFile</span>, <span onmouseout="hideTip(event, 'fs12', 34)" onmouseover="showTip(event, 'fs12', 34)" class="i">deployment</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs24', 35)" onmouseover="showTip(event, 'fs24', 35)" class="i">ServiceName</span>)
</code></pre></td>
</tr>
</table>

<p>This lets you reconnect to your cluster later by using the following:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="prep">#load</span> <span class="s">&quot;AzureCluster.fsx&quot;</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs25', 36)" onmouseover="showTip(event, 'fs25', 36)" class="i">cluster</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs26', 37)" onmouseover="showTip(event, 'fs26', 37)" class="t">Config</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs27', 38)" onmouseover="showTip(event, 'fs27', 38)" class="f">GetCluster</span>()
</code></pre></td>
</tr>
</table>

<h2><a name="Summary" class="anchor" href="#Summary">Summary</a></h2>

<p>In this tutorial, you've learned how to provision an MBrace clusters running on Azure using MBrace.Azure.Management.
You are now ready to proceed with further samples to learn more about the MBrace programming model.</p>

<p>To learn more about provisioning, monitoring, scaling and deleting clusters using MBrace.Azure.Management
see <a href="going-further/200-managing-azure-clusters.html">going-further/200-managing-azure-clusters.fsx</a>.</p>

<div class="tip" id="fs1">namespace MBrace</div>
<div class="tip" id="fs2">namespace MBrace.Azure</div>
<div class="tip" id="fs3">namespace MBrace.Azure.Management</div>
<div class="tip" id="fs4">val pubSettingsFile : string<br /><br />Full name: 0-provision-azure-cluster.pubSettingsFile</div>
<div class="tip" id="fs5">val region : Region<br /><br />Full name: 0-provision-azure-cluster.region</div>
<div class="tip" id="fs6">type Region =<br />&#160;&#160;private new : regionId:string -&gt; Region<br />&#160;&#160;override Equals : other:obj -&gt; bool<br />&#160;&#160;override GetHashCode : unit -&gt; int<br />&#160;&#160;override ToString : unit -&gt; string<br />&#160;&#160;member Id : string<br />&#160;&#160;static member Define : regionId:string -&gt; Region<br />&#160;&#160;static member Central_US : Region<br />&#160;&#160;static member East_Asia : Region<br />&#160;&#160;static member East_US : Region<br />&#160;&#160;static member East_US_2 : Region<br />&#160;&#160;...<br /><br />Full name: MBrace.Azure.Management.Region</div>
<div class="tip" id="fs7">property Region.North_Europe: Region</div>
<div class="tip" id="fs8">val vmSize : VMSize<br /><br />Full name: 0-provision-azure-cluster.vmSize</div>
<div class="tip" id="fs9">type VMSize =<br />&#160;&#160;private new : vmId:string -&gt; VMSize<br />&#160;&#160;override Equals : other:obj -&gt; bool<br />&#160;&#160;override GetHashCode : unit -&gt; int<br />&#160;&#160;override ToString : unit -&gt; string<br />&#160;&#160;member Id : string<br />&#160;&#160;static member Define : vmId:string -&gt; VMSize<br />&#160;&#160;static member A0 : VMSize<br />&#160;&#160;static member A1 : VMSize<br />&#160;&#160;static member A10 : VMSize<br />&#160;&#160;static member A11 : VMSize<br />&#160;&#160;...<br /><br />Full name: MBrace.Azure.Management.VMSize</div>
<div class="tip" id="fs10">property VMSize.Large: VMSize</div>
<div class="tip" id="fs11">val vmCount : int<br /><br />Full name: 0-provision-azure-cluster.vmCount</div>
<div class="tip" id="fs12">val deployment : Deployment<br /><br />Full name: 0-provision-azure-cluster.deployment</div>
<div class="tip" id="fs13">type SubscriptionManager =<br />&#160;&#160;private new : client:SubscriptionClient * defaultRegion:Region * _logger:ISystemLogger * logLevel:LogLevel -&gt; SubscriptionManager<br />&#160;&#160;member AttachLogger : l:ISystemLogger -&gt; IDisposable<br />&#160;&#160;member DeleteDeployment : serviceName:string -&gt; unit<br />&#160;&#160;member DeleteDeploymentAsync : serviceName:string -&gt; Async&lt;unit&gt;<br />&#160;&#160;member GetDeployment : serviceName:string -&gt; Deployment<br />&#160;&#160;member GetDeploymentAsync : serviceName:string -&gt; Async&lt;Deployment&gt;<br />&#160;&#160;member GetDeployments : unit -&gt; Deployment []<br />&#160;&#160;member GetDeploymentsAsync : unit -&gt; Async&lt;Deployment []&gt;<br />&#160;&#160;member Provision : vmCount:int * ?serviceName:string * ?region:Region * ?vmSize:VMSize * ?mbraceVersion:string * ?storageAccount:string * ?serviceBusAccount:string * ?cloudServicePackage:string * ?serviceLabel:string * ?enableDiagnostics:bool -&gt; Deployment<br />&#160;&#160;member ProvisionAsync : vmCount:int * ?serviceName:string * ?region:Region * ?vmSize:VMSize * ?mbraceVersion:string * ?storageAccount:string * ?serviceBusAccount:string * ?cloudServicePackage:string * ?serviceLabel:string * ?enableDiagnostics:bool -&gt; Async&lt;Deployment&gt;<br />&#160;&#160;...<br /><br />Full name: MBrace.Azure.Management.SubscriptionManager</div>
<div class="tip" id="fs14">static member SubscriptionManager.Provision : publishSettingsFile:string * region:Region * vmCount:int * ?vmSize:VMSize * ?cloudServicePackage:string * ?subscriptionId:string * ?logger:MBrace.Runtime.ISystemLogger * ?logLevel:LogLevel * ?mbraceVersion:string * ?storageAccount:string * ?serviceBusAccount:string * ?serviceName:string * ?serviceLabel:string * ?enableDiagnostics:bool -&gt; Deployment</div>
<div class="tip" id="fs15">val cluster : AzureCluster<br /><br />Full name: 0-provision-azure-cluster.cluster</div>
<div class="tip" id="fs16">type AzureCluster =<br />&#160;&#160;inherit MBraceClient<br />&#160;&#160;private new : manager:ClusterManager * faultPolicy:FaultPolicy option -&gt; AzureCluster<br />&#160;&#160;member AttachLocalWorker : ?workerId:string * ?workingDirectory:string * ?maxWorkItems:int * ?logFile:string * ?logLevel:LogLevel * ?heartbeatInterval:TimeSpan * ?heartbeatThreshold:TimeSpan * ?background:bool -&gt; unit<br />&#160;&#160;member AttachLocalWorkers : workerCount:int * ?maxWorkItems:int * ?logLevel:LogLevel * ?heartbeatInterval:TimeSpan * ?heartbeatThreshold:TimeSpan * ?background:bool -&gt; unit<br />&#160;&#160;member CullNonResponsiveWorkers : heartbeatThreshold:TimeSpan -&gt; unit<br />&#160;&#160;member CullNonResponsiveWorkersAsync : heartbeatThreshold:TimeSpan -&gt; Async&lt;unit&gt;<br />&#160;&#160;member KillAllLocalWorkers : unit -&gt; unit<br />&#160;&#160;member KillLocalWorker : worker:IWorkerRef -&gt; bool<br />&#160;&#160;member Reset : ?deleteQueues:bool * ?deleteRuntimeState:bool * ?deleteLogs:bool * ?deleteUserData:bool * ?deleteAssemblyData:bool * ?force:bool * ?reactivate:bool -&gt; unit<br />&#160;&#160;member ResetAsync : ?deleteQueues:bool * ?deleteRuntimeState:bool * ?deleteLogs:bool * ?deleteUserData:bool * ?deleteAssemblyData:bool * ?force:bool * ?reactivate:bool -&gt; Async&lt;unit&gt;<br />&#160;&#160;...<br /><br />Full name: MBrace.Azure.AzureCluster</div>
<div class="tip" id="fs17">static member AzureCluster.Connect : deployment:Deployment * ?clientId:string * ?faultPolicy:MBrace.Core.FaultPolicy * ?logger:MBrace.Runtime.ISystemLogger * ?logLevel:LogLevel -&gt; AzureCluster<br />static member AzureCluster.Connect : config:Configuration * ?clientId:string * ?faultPolicy:MBrace.Core.FaultPolicy * ?logger:MBrace.Runtime.ISystemLogger * ?logLevel:LogLevel -&gt; AzureCluster<br />static member AzureCluster.Connect : storageConnectionString:string * serviceBusConnectionString:string * ?clientId:string * ?faultPolicy:MBrace.Core.FaultPolicy * ?logger:MBrace.Runtime.ISystemLogger * ?logLevel:LogLevel -&gt; AzureCluster</div>
<div class="tip" id="fs18">property Deployment.Configuration: Configuration</div>
<div class="tip" id="fs19">type ConsoleLogger = MBrace.Runtime.ConsoleLogger<br /><br />Full name: MBrace.Azure.Management.ConsoleLogger</div>
<div class="tip" id="fs20">type LogLevel = MBrace.Runtime.LogLevel<br /><br />Full name: MBrace.Azure.LogLevel</div>
<div class="tip" id="fs21">MBrace.Runtime.LogLevel.Info: MBrace.Runtime.LogLevel = 4</div>
<div class="tip" id="fs22">Multiple items<br />module Config<br /><br />--------------------<br />type Config =<br />&#160;&#160;private new : unit -&gt; Config<br />&#160;&#160;static member DefaultLogger : ISystemLogger<br />&#160;&#160;static member DefaultLogger : ISystemLogger with set<br /><br />Full name: MBrace.Azure.Management.Config</div>
<div class="tip" id="fs23">val RecordClusterDetails : pubSettingsFile:string * clusterName:string -&gt; unit<br /><br />Full name: Config.RecordClusterDetails<br /><em><br /><br />&#160;Modify this file to record the cluster details</em></div>
<div class="tip" id="fs24">property Deployment.ServiceName: string</div>
<div class="tip" id="fs25">val cluster : MBrace.Azure.AzureCluster<br /><br />Full name: provisionazurecluster.cluster</div>
<div class="tip" id="fs26">module Config</div>
<div class="tip" id="fs27">val GetCluster : unit -&gt; MBrace.Azure.AzureCluster<br /><br />Full name: Config.GetCluster<br /><em><br /><br />&#160;Connect to the cluster </em></div>

        </div>
        <div class="span3">
          <a href="http://www.mbrace.io/index.html">
            <img src="http://www.mbrace.io/img/mbrace.png" alt="F# Project" style="width:150px;margin:10px" />
          </a>
          <ul class="nav nav-list" id="menu" style="margin-top: 20px;">
            <li class="nav-header">MBrace.Core and MBrace.Azure</li>
            <li><a href="http://www.mbrace.io/index.html">Home page</a></li>
            <li class="divider"></li>
            <li><a href="http://www.nuget.org/packages/MBrace.Core">Get Library via NuGet</a></li>
            <li><a href="http://github.com/mbraceproject/MBrace.Core">Source Code on GitHub</a></li>
            <li><a href="http://github.com/mbraceproject/MBrace.Core/blob/master/LICENSE.md">License</a></li>
            <li><a href="http://github.com/mbraceproject/MBrace.Core/blob/master/RELEASE_NOTES.md">Release Notes</a></li>

            <li class="nav-header">Getting Started</li>
            <li><a href="http://www.mbrace.io/thespian-tutorial.html">Local cluster</a></li>
            <li><a href="http://www.mbrace.io/azure-tutorial.html">Azure cluster</a></li>
            <li class="divider"></li>
            <li><a target="_blank" href="http://www.mbrace.io/mbrace-plos.pdf">PLOS'13 Publication</a></li>

            <li class="nav-header">Documentation</li>
            <li><a href="http://www.mbrace.io/programming-model.html">Programming model</a></li>
            <li><a href="http://www.mbrace.io/reference/core/index.html">API Reference (MBrace.Core)</a></li>
            <li><a href="http://www.mbrace.io/reference/runtime/index.html">API Reference (MBrace.Runtime)</a></li>
            <li><a href="http://www.mbrace.io/reference/flow/index.html">API Reference (MBrace.Flow)</a></li>
            <li class="divider"></li>
            <li><a href="http://www.mbrace.io/reference/azure/index.html">Reference (Azure)</a></li>
            <li><a href="http://www.mbrace.io/reference/thespian/index.html">Reference (Local)</a></li>
          </ul>
        </div>
      </div>
    </div>
    <a href="http://github.com/mbraceproject/MBrace.Core"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub"/></a>
  </body>
  </html>
